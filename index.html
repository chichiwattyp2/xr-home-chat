<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>A-Frame + Google + Chat GPT</title>

    <!-- CSP (allows blob: for canvas textures) -->
<!--    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self' https://aframe.io https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline' 'unsafe-eval';
      script-src-elem 'self' https://aframe.io https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline' 'unsafe-eval';
      connect-src 'self' blob: https://api.openai.com wss://api.openai.com https://cdn.aframe.io https://cdn.glitch.com https://cdn.glitch.global https://www.youtube.com https://i.ytimg.com https://*.googleapis.com https://*.gstatic.com https://docs.google.com https://www.googleapis.com https://raw.githubusercontent.com https://github.com https://user-images.githubusercontent.com;
      img-src 'self' data: blob: https://cdn.aframe.io https://i.ytimg.com https://lh3.googleusercontent.com https://*.googleusercontent.com https://*.gstatic.com https://*.ggpht.com https://*.githubusercontent.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src 'self' data: https://cdn.aframe.io https://fonts.gstatic.com;
    "> -->

    <!-- Google Fonts (used by the canvas renderer) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Asimovian&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Rampart+One&display=swap" rel="stylesheet">

    <!-- A-Frame + components -->
   <script src="https://cdn.aframe.io/releases/1.7.1/aframe.min.js"></script>
 <script src="sheets.js" defer></script>
    <script type="module" src="client.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/mayognaise/aframe-mouse-cursor-component/dist/aframe-mouse-cursor-component.min.js" defer></script>
    <script src="https://unpkg.com/aframe-controller-cursor-component@0.2.7/dist/aframe-controller-cursor-component.min.js" defer></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js" defer></script>

    <link href="lookbook-xr-override.css" rel="stylesheet" type="text/css" media="all">
  </head>
  <body>
    <!-- Overlay UI -->
    <div id="ui">
      <input id="prompt" placeholder="Ask somethingâ€¦" />
      <button id="send">Send</button>
      <button id="voice">ðŸŽ¤ Voice</button>
    </div>

    <a-scene>
      <!-- Register assets FIRST so A-Frame can build textures safely -->
      <a-assets timeout="15000">
        <!-- Move canvases into a-assets to avoid 0x0 textures -->
        <canvas id="chatTextCanvas" width="1024" height="256"></canvas>
        <canvas id="chatHintCanvas" width="1024" height="192"></canvas>
      </a-assets>

      <!-- Solid sky (remove any sky1.jpg reference to kill the 404) -->
      <a-sky color="#0b0d12"></a-sky>

      <!-- Where rows spawn -->
      <a-entity id="csv-root"></a-entity>

      <!-- Camera with mouse cursor + raycaster for clicking -->
      <a-entity id="player"
                camera
                spawn-in-circle="radius:3;"
                position="0 1.9 0"
                wasd-controls
                look-controls>
        <a-cursor></a-cursor>
      </a-entity>

      <!-- Chat panel (canvas textures) -->
      <a-entity id="chatPanel" data-raycastable
                position="9.43415 3.83854 -1.88325"
                rotation="0 -45 0" scale="5 5 5">
        <a-plane width="1.35" height="0.8"
                 color="#111" material="opacity: 0.9"></a-plane>

        <!-- Main chat text plane (uses chatTextCanvas) -->
        <a-plane id="chatTextPlane"
                 material="src: #chatTextCanvas; transparent: true"
                 position="-0.62 0.28 0.01"
                 scale="0.74 0.30 1"></a-plane>

        <!-- Hint plane (uses chatHintCanvas) -->
        <a-plane id="chatHintPlane"
                 material="src: #chatHintCanvas; transparent: true"
                 position="-0.62 -0.28 0.01"
                 scale="0.74 0.22 1"></a-plane>
      </a-entity>
    </a-scene>

    <audio id="assistantAudio" autoplay></audio>
  </body>
</html>
