<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-controller-cursor-component@0.2.7/dist/aframe-controller-cursor-component.min.js" defer></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js" defer></script>
<script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
    <script src="js/travel-node-component.js"></script>
    <script src="js/nav.js"></script>
    <script>
// (Optional) keep your encoder
function encodeHtml(str) {
  var buf = [];
  for (var i = str.length - 1; i >= 0; i--) {
    buf.unshift(["&#", str[i].charCodeAt(), ";"].join(""));
  }
  return buf.join("");
}

$(function () {
  // ---- CONFIG ----
  const SHEET_ID = "1fy-ZztZlhwgfz1wH8YGji2zuiiEfV88XyCRBDzLB1AA";
  const GID = 9; // set this to the tab’s gid (check your sheet URL)
  const gvizUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

  // IMPORTANT: make the sheet “Anyone with the link → Viewer” so this works
  $.get(gvizUrl, function (text) {
    // Strip the GViz wrapper -> parse JSON
    const json = JSON.parse(text.substring(text.indexOf("{"), text.lastIndexOf(")") ));
    const rows = json.table.rows || [];

    const listings = [];
    // Assume first row is header: Title | Image | Link
    for (let r = 1; r < rows.length; r++) {
      const cells = rows[r].c || [];
      const title = cells[0]?.v ?? "";
      const image = cells[1]?.v ?? "";
      const link  = cells[2]?.v ?? "";

      if (title || image || link) {
        listings.push({
          title: encodeHtml(String(title)),
          image: String(image),
          link: String(link)
        });
      }
    }

    // --- render like your original ---
    let r = 0, i = 0, p = 0, h = 0, pages = 0;

    for (const listing of listings) {
      $("#container").append(`
        <a-image position="${i * 2}.${i} ${r * 1.3} 0"
                 width="2" height="1"
                 link="href: ${listing.link}"
                 src="${listing.image}"
                 event-set__enter="_event: mouseenter; _target: #highlight-${h}; visible: true"
                 event-set__leave="_event: mouseleave; _target: #highlight-${h}; visible: false">
          <a-entity
            geometry="primitive: plane; width: 2; height: .2"
            material="color: #111"
            text="align:center; value: ${listing.title}"
            position="0 -.6 0"></a-entity>
          <a-plane id="highlight-${h}" width="2.05" height="1.25"
                   material="shader: flat; color: white;"
                   position="0 -0.1 -0.01" visible="false"></a-plane>
        </a-image>
      `);

      i++; h++;
      if (i === 4) { r--; i = 0; p++; }
      if (p === 3) { r += 20; p = 0; pages++; console.log(pages); }
    }
  });
});
</script>
  </head>
  <body>
    <a-scene 
      antialias="true"
      vr-mode-ui="enabled: true"
      loading-screen="backgroundColor: #212121"
      physics
    >
    
  
      <a-entity
        id="player”
      position="0 1.9 0" camera look-controls wasd-controls>
     
     
        <a-cursor></a-cursor>
      </a-entity>

      <a-entity
        environment="dressing: none; ground: flat; fog: 0; skyType: none; groundColor: #111;gridColor: #202020; grid: 2x2; groundTexture: none"
      ></a-entity>

      <a-entity id="catalog" scale=".2 .2 .2" position="0 1.1 -1.05">
        <a-entity
          class="container"
          id="container"
          position="-3.15 4 0"
        ></a-entity>
        <a-entity id="arrows" position="0 .3 .2">
          <a-image
            id="mainLogo"
            src="https://cdn.glitch.com/a0f896a4-4e28-47a9-b792-0307f9c0c167%2Fchris-menu.png"
            position="0 5.8 0"
            width="4"
            height="2"
          ></a-image>
        </a-entity>

        <a-entity id="menu" position="-3.06 4.98 0" scale=".35 .35 .35">
          <a-entity
            link="href: index.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #606060"
            text="align:center; value:Portfolio; width:10;"
            position="0 0 0"
          >
          </a-entity>
          <a-entity
            link="href: resume.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #111"
            text="align:center; value: XR Resume; width:10;"
            position="3.5 0 0"
          >
          </a-entity>
          <a-entity
            link="href: contact.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #111"
            text="align:center; value: Contact; width:10;"
            position="7 0 0"
          >
          </a-entity>
          <a-entity
            link="href: scenes.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #111"
            text="align:center; value: Scenes; width:10;"
            position="10.5 0 0"
          >
          </a-entity>
          <a-entity
            link="href: browse.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #111"
            text="align:center; value: Browser; width:10;"
            position="14 0 0"
          >
          </a-entity>
          <a-entity
            link="href: broadcasting.html"
            geometry="primitive: plane; width: 3.4; height: 1"
            material="color: #111"
            text="align:center; value: tab 6; width:10;"
            position="17.5 0 0"
          >
          </a-entity>
        </a-entity>
      </a-entity>
      <a-image
        id="how-to"
        src="https://cdn.glitch.com/22ec690f-3d8c-49a9-b10a-903a96c741e5%2Fpng.png"
        position="-1.26232 1.6 0.02932"
        width="0.47"
        height="0.3"
        material=""
        geometry=""
        rotation="0 90 0"
        scale="3 3 3"
      ></a-image>

      <a-entity
        geometry="primitive: plane; height: 10; width: auto"
        material="opacity: 0;"
        typer="message: Click on a item to get in touch.\n\n; on: click;"
        text="value: Looking forward to hearing from you.; font: roboto; align: center; color: white; width: 2.8; zOffset: 0.01; letterSpacing: -1; tabSize: 1; side: double;"
        position="0 1.4 -2"
        rotation="-15 0 0"
      ></a-entity>
    </a-scene>
  </body>
